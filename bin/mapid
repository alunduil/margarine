#!/usr/bin/env python
#
# Copyright (C) 2013 by Alex Brandt <alex.brandt@rackspace.com>
#
# pycore is freely distributable under the terms of an MIT-style license.
# See COPYING or http://www.opensource.org/licenses/mit-license.php.

import logging
import os
import argparse

from margarine.parameters import Parameters
from margarine.parameters import CONFIGURATION_DIRECTORY

from margarine.api.application import APPLICATION
from margarine.api.parameters import PARAMETERS

logger = logging.getLogger(__name__)

def get_parameters():
    parser = argparse.ArgumentParser()
    parser.add_argument("--configuration", "-f",
            default = os.path.join(CONFIGURATION_DIRECTORY, "margarine.conf")
            )
    pre_arguments, _ = parser.parse_known_args()

    return Parameters("api", pre_arguments.configuration, PARAMETERS)

def extract_flask_parameters(parameters):
    flask_parameters = {}

    if "host" in parameters:
        flask_parameters["host"] = parameters["host"]

    if "port" in parameters:
        flask_parameters["port"] = parameters["port"]
    
    if "debug" in parameters:
        flask_parameters["debug"] = parameters["debug"]

    return flask_parameters

def configure_logging(parameters):
    pass

if __name__ == "__main__":
    parameters = get_parameters()

    APPLICATION.run(**extract_flask_parameters(parameters))

